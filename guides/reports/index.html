
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Writing reproducible reports in R with markdown, knitr and pandoc - Nice R Code</title>
  <meta name="author" content="Rich FitzJohn & Daniel Falster">

  
  <meta name="description" content="Writing reproducible reports in R with markdown, knitr and pandoc 29 July 2013 So you have some code, data and a cool result, now it’s time to &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://nicercode.github.com/guides/reports/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/atom.xml" rel="alternate" title="Nice R Code" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href='http://fonts.googleapis.com/css?family=Bitter:400,700,400italic' rel='stylesheet' type='text/css'>
<link href='http://fonts.googleapis.com/css?family=Source+Sans+Pro:400,700,400italic' rel='stylesheet' type='text/css'>

<!-- mathjax config similar to math.stackexchange -->
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  jax: ["input/TeX", "output/HTML-CSS"],
  tex2jax: {
    inlineMath: [ ['$', '$'] ],
    displayMath: [ ['$$', '$$']],
    processEscapes: true,
    skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
  },
  messageStyle: "none",
  "HTML-CSS": { preferredFont: "TeX", availableFonts: ["STIX","TeX"] }
});
</script>
<script src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_HTML" type="text/javascript"></script>

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-39493992-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body    class="collapse-sidebar sidebar-footer" >
  <header role="banner"><hgroup>
  <h1><a href="/">Nice R Code</a></h1>
  
    <h2>Punning code better since 2013</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:nicercode.github.com" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
  <li><a href="/guide.html">Guides</a></li>
  <li><a href="/modules">Modules</a></li>
  <li><a href="/about">About</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article role="article">
  
  <header>
    <h1 class="entry-title">Writing reproducible reports in R with markdown, knitr and pandoc</h1>
    <p class="meta">








  


<time datetime="2013-07-29T00:00:00+10:00" pubdate data-updated="true">29 July 2013</time></p>
  </header>
  
  <p>So you have  some code, data and a cool result, now it’s time to communicate this with your collaborators (or supervisor). What do you do? In this guide, we want to show you how to write nice, reproducible reports using some of the fantastic, free tools and packages that are now on offer. These tools will help you communicate your science, and hopefully mean that you never copy and paste your R output again.</p>

<p>As a start, let’s review the key components to any good analysis:</p>

<ol>
  <li>Data</li>
  <li>Code used to analyse the data</li>
  <li>Figures and tables generated by the code</li>
  <li>Text, interpreting the figures and results, and describing the methods.</li>
</ol>

<p>These elements come together in the form of a report. As scientists, we write many reports, both small and large. Large reports like papers, are rare, but we write smaller reports all the time. These include all the preliminary results, weekly updates, emails with figures, and simply one’s own note taking, written during the lifespan of a project. Traditionally, most biologists do stages 2 and 3 in R, then fire up Word or Powerpoint and copy-paste everything for stage 4. That works, but there several downsides to this approach:</p>

<ul>
  <li>lots of time wasted, plus copy and pasting sucks</li>
  <li>your interpretation is separated from your code</li>
  <li>Word doesn’t offer syntax highlighting, so it’s hard to read code presented this way,</li>
  <li>Word documents can’t be tracked (very well) under version control</li>
  <li>the report cannot be regenerated without doing it all that copying and pasting over again.</li>
</ul>

<p>Thankfully, there now exists a <em>much</em> nicer way to write reports, using the wonderful package <a href="http://yihui.name/knitr/"><code>knitr</code></a>, a simple text-markup language called <a href="http://daringfireball.net/projects/markdown/">markdown</a>, and the universal document conversion program called <a href="http://johnmacfarlane.net/pandoc/">pandoc</a>. It’s also now possible to weave your interpretation (stage 4) in with your R code (stage 2) and results (stage 3), to produce nice, self-contained and reproducible reports. Together, these provide a powerful tool set for scientists looking to save time and do reproducible research.</p>

<h1 id="what-is-markdown-and-why-use-it">What is markdown and why use it?</h1>

<p>The start of this process is the markdown language. Markdown’s goal is to be “<em>as easy-to-read and easy-to-write as is feasible</em>”. In practice, it is a simple set of formatting commands applied to a plain text document that can be easily converted into fancy formatted html, pdf or word docs. But unlike <code>html</code>, <code>rtf</code>, <code>latex</code>, or pretty much any other markup text, markdown is very readable, as is. And because it uses <a href="http://bettermess.com/a-plain-text-primer/">Plain text</a>, the files are small and easy to edit on a variety of devices.</p>

<p>As scientists we write a lot, not just papers, but also notes, code, emails, reminders, to do lists, blog posts etc. Increasingly, I use markdown for most of my note taking and report writing.</p>

<p>Lots of people have written talking about how wonderful markdown is, e.g. <a href="http://lifehacker.com/5943320/what-is-markdown-and-why-is-it-better-for-my-to+do-lists-and-notes">here</a>, and <a href="https://twitter.com/search?q=love%20%20markdown&amp;src=typd">here</a>.</p>

<blockquote class="twitter-tweet"><p>Why you will fall in love with Markdown - <a href="http://t.co/PGsCPe5s">http://t.co/PGsCPe5s</a></p>&mdash; Chen Luo (@chenluois) <a href="https://twitter.com/chenluois/statuses/257295154073960448">October 14, 2012</a></blockquote>
<script async="" src="//platform.twitter.com/widgets.js" charset="utf-8"></script>

<p>Because it is plain text, you can write markdown in any program, all you need is a <a href="http://daringfireball.net/projects/markdown/syntax">syntax guide</a>. However, the best test editors also allow you to view your code as formatted html. I use <a href="http://www.sublimetext.com/">Sublimetext</a> on my computer, and <a href="http://notesy-app.com/">notesy</a> on my iphone. Here’s a list of <a href="http://mashable.com/2013/06/24/markdown-tools/">78 other editors to checkout</a>.</p>

<p>Oh yeah, mark down docs usually end with extension <code>.md</code>, or <code>.markdown</code>.</p>

<h1 id="rmarkdown">RMarkdown</h1>

<p>Markdown proved so useful that many different coding groups adopted it, but also adding there own ‘flavours’. So far we know of the following:</p>

<ul>
  <li>the original markdown</li>
  <li>github flavoured markdown,</li>
  <li>pandoc markdown, and</li>
  <li>multimarkdown.</li>
</ul>

<p>Each of these offers a slightly different set of features.</p>

<p>RStudio implements something called “R-flavoured markdown” (or
RMarkdown) which can be based on any of these flavours.  In addition,
it includes “code blocks” – pieces of code that will be run by R.
These look like this:</p>

<pre><code>```{r}
mean(1:10) # or some other code
```
</code></pre>

<p>which produces something like this:</p>

<pre><code>```
mean(1:10) # or some other code
```
```
## [1] 5.5
```
</code></pre>

<p>which would be rendered by Markdown like this:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class=""><span class="line">mean(1:10) # or some other code</span></code></pre></td></tr></table></div></figure></notextile></div>
<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class=""><span class="line">## [1] 5.5</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>R markdown is used within Rstudio and allows R code to be weaved in
with bits of text. Files written in R markdown have the extension
<code>.Rmd</code>.</p>

<p>Think of R markdown as something that <em>compiles</em> into one of the above
markdown variants.  But first, you need to run all the bits of R code</p>

<h1 id="reports-with-knitr">Reports with knitr</h1>

<p>The <a href="http://yihui.name/knitr/"><code>knitr</code></a> package was written to combine elements of RMarkdown and R code <a href="http://yihui.name/en/2012/06/enjoyable-reproducible-research/">within a single document</a>. The best way to realise the strength of knitr is to start with an example.</p>

<p>Open up Rstudio and install the knitr package</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class=""><span class="line">install.packages(knitr)</span></code></pre></td></tr></table></div></figure></notextile></div>
<p>Then open <a href="example.Rmd">this demo file</a> and click the <code>knit HTML</code> button</p>

<p><img src="http://www.rstudio.com/images/docs/markdownOverview.png" alt="An Rmd file in Rstudio" /></p>

<p>This file is written in RMarkdown and includes bits of text and code. The code bits are the “chunks” surrounded tick marks.</p>

<p><img src="http://www.rstudio.com/images/docs/markdownUntitled.png" alt="An Rmd file in Rstudio" />.</p>

<p>Clicking on  <code>knit HTML</code> does several things</p>

<ol>
  <li>It runs all the bits of code in the file</li>
  <li>It generates a markdown file, including bits of the original document and it’s output.</li>
  <li>It converts the markdown document into html.</li>
</ol>

<p>You can also make the document from the console, with the following set of commands:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
</pre></td><td class="code"><pre><code class="r"><span class="line">library<span class="p">(</span>knitr<span class="p">)</span>
</span><span class="line">library<span class="p">(</span>markdown<span class="p">)</span>
</span><span class="line">knit<span class="p">(</span><span class="s">&quot;example.Rmd&quot;</span><span class="p">)</span>  <span class="c1"># produces the md file</span>
</span><span class="line">markdownToHTML<span class="p">(</span><span class="s">&quot;example.md&quot;</span><span class="p">,</span> <span class="s">&quot;example.html&quot;</span><span class="p">)</span>  <span class="c1"># converts an md file to html</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>Note, for this code to work, the example file needs to be in your working directory, or you need to provide the path to the RMD file:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class="r"><span class="line">knit<span class="p">(</span><span class="s">&quot;myPath/example.Rmd&quot;</span><span class="p">)</span>  <span class="c1"># produces the md file</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>OK, so you have a document (html file), where you can document your analyses. Now just replace the example code with some real material and away you go.</p>

<p>Some benefits of this approach include:</p>

<ul>
  <li>no copying and pasting</li>
  <li>your report can be easily updated, once you have more data, new ideas etc</li>
  <li>because they are just like any other code, you can track your knitr scripts under version control.</li>
  <li>if it is important, you can show bits of the code used to generate the results.</li>
  <li>your analysis is fully transparent and reproducible.</li>
</ul>

<p>People now use knitr for all sorts of things, e.g.</p>

<ul>
  <li>writing reports of their data (here’s one by Rich as <a href="http://www.zoology.ubc.ca/prog/diversitree/examples/unreplicated/unreplicated.Rmd">Rmd</a> and <a href="http://www.zoology.ubc.ca/prog/diversitree/examples/unreplicated/">html</a> )</li>
  <li>preparing tutorials</li>
  <li>writing blog posts.</li>
</ul>

<blockquote class="twitter-tweet"><p>I love <a href="https://twitter.com/search?q=%23knitr&amp;src=hash">#knitr</a> for <a href="https://twitter.com/search?q=%23rstats&amp;src=hash">#rstats</a> with <a href="https://twitter.com/rstudioapp">@rstudioapp</a>! Made my first report yesterday, now generating customised reports for &gt;50 data contributors.</p>&mdash; Daniel Falster (@adaptive_plant) <a href="https://twitter.com/adaptive_plant/statuses/324773337224077313">April 18, 2013</a></blockquote>
<script async="" src="//platform.twitter.com/widgets.js" charset="utf-8"></script>

<h1 id="tricks-to-working-with-knitr-and-rstudio">Tricks to working with knitr and Rstudio</h1>

<p>For beginners, the following resources may prove useful</p>

<ul>
  <li>Rstudio includes a markdown syntax guide, just click the MD button in the toolbar</li>
  <li>Also see their online documentation on using Rmarkdown (http://www.rstudio.com/ide/docs/authoring/using_markdown)</li>
</ul>

<h2 id="avoiding-trouble">Avoiding trouble</h2>

<p>We have advised you
<a href="http://nicercode.github.io/blog/2013-04-05-projects/">previously</a>
against using <code>setwd()</code> in your scripts. That is even more important
here. Changing the working directory within an Rmd file will lead to
trouble. Therefore we advise you to write all Rmd files to run
assuming they are in the root directory of your project.</p>

<h2 id="revealing-and-hiding-code-and-output">Revealing and hiding code and output</h2>

<p>You can choose what gets included in the evnetual report, by setting options for each code chunk.</p>

<ul>
  <li><code>echo= TRUE</code>: choose this if you want the code to be displayed in the report, of <code>FALSE</code> if you want to hide it.</li>
  <li><code>results= "hide"</code>: choose this if you want to hide the results of running the code.</li>
  <li><code>eval =FALSE</code>: causes the current chunk not to be evaluated.</li>
</ul>

<p>For more detail about these options, checkout</p>

<ul>
  <li>RStudio’s guide on <a href="http://rpubs.com/gallery/options">Customizing Chunk Options</a></li>
  <li>the worked example in <a href="example.Rmd">our example script</a></li>
  <li>full documentation on the <a href="http://yihui.name/knitr/options">knitr site</a>.</li>
</ul>

<h2 id="converting-to-different-document-formats">Converting to different document formats</h2>

<p>Now what if you want to produce another document type, instead of an html file? Enter pandoc.</p>

<blockquote class="twitter-tweet"><p>Pandoc &#8211; love it! Cross platform command-line converter to/from HTML, Markdown, docx, EPUB,  LaTeX, DocBook, etc.  <a href="http://t.co/OAtPTt9T">http://t.co/OAtPTt9T</a></p>&mdash; Sam Dutton (@sw12) <a href="https://twitter.com/sw12/statuses/276013932047634432">December 4, 2012</a></blockquote>
<script async="" src="//platform.twitter.com/widgets.js" charset="utf-8"></script>

<p>According to it’s <a href="http://johnmacfarlane.net/pandoc/README.html">creator</a>, “If you need to convert files from one markup format into another, pandoc is your swiss-army knife. It can read a variety of inputs, including markdown, reStructuredText, HTML, LaTeX, MediaWiki markup, and DocBook XML; and it can write plain text, markdown, reStructuredText, XHTML, HTML 5, LaTeX (including beamer slide shows), ConTeXt, RTF, DocBook XML, OpenDocument XML, ODT, Word docx, GNU Texinfo, MediaWiki markup, EPUB, FictionBook2, Textile, groff man pages, Emacs Org-Mode, AsciiDoc, and Slidy, Slideous, DZSlides, or S5 HTML slide shows. It can also produce PDF output on systems where LaTeX is installed.””</p>

<p>First, you’ll need to download and <a href="http://johnmacfarlane.net/pandoc/installing.html">install pandoc</a>. Once installed you can then use the <code>pnadoc</code> function, included with the knitr package to convert the generated md file into whatever format you like. E.g. to convert our example above into a word doc, we write:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
</pre></td><td class="code"><pre><code class="r"><span class="line">library<span class="p">(</span>knitr<span class="p">)</span>
</span><span class="line">library<span class="p">(</span>markdown<span class="p">)</span>
</span><span class="line">knit<span class="p">(</span><span class="s">&quot;example.Rmd&quot;</span><span class="p">)</span>  <span class="c1"># produces the md file</span>
</span><span class="line">pandoc<span class="p">(</span><span class="s">&quot;example.md&quot;</span><span class="p">,</span> format <span class="o">=</span> <span class="s">&quot;docx&quot;</span><span class="p">)</span>  <span class="c1"># converts md file into docx</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<h2 id="here-comes-the-future-presentations-and-everything">Here comes the future: presentations and everything</h2>

<p>In addition to writing reports, you can also use knitr and Rmarkdown to <a href="http://www.rstudio.com/ide/docs/presentations/overview">write slide shows directly from within Rstudio</a>, the publish these straight to the <a href="http://rpubs.com/">Rpubs website</a>. To use the presentation function, you need to download and <a href="http://www.rstudio.org/download/daily">install the development version of Rstudio</a>, but this feature will no doubt become standard in the near future.</p>

<p>For example, here’s a presentation on R resources, <a href="http://rpubs.com/recology_/rresources">by Scott Chamberlain</a>.</p>

<h1 id="reproducible-research">Reproducible research</h1>

<p>So there you have it, a set of tools for doing reproducible research in R. In our view, markdown needs a little more work before we’d recommend it for writing an entire paper, but it’s fantastic for most of the preliminary work. And it’s especially good for doing reproducible research, when combined with version control and some nice R code.</p>

<h1 id="more-information">More information</h1>

<p>Here’s another knitr example script by <a href="https://gist.github.com/jeromyanglim/2716336">Jeromy Anglim</a>.</p>

<p>Also, keep an eye out for <a href="http://yihui.name/">Yihui Xie</a>’s upcoming book:</p>

<blockquote class="twitter-tweet"><p>Dynamic Documents with R and knitr (Chapman &amp; Hall/CRC The R Series) by Yihui Xie <a href="http://t.co/31VZrxjW9r">http://t.co/31VZrxjW9r</a> via <a href="https://twitter.com/amazon">@amazon</a></p>&mdash; Flávio Clésio (@flavioclesio) <a href="https://twitter.com/flavioclesio/statuses/348187106138537984">June 21, 2013</a></blockquote>
<script async="" src="//platform.twitter.com/widgets.js" charset="utf-8"></script>


  
</article>

  <section>
    <h1>Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2013-07-09-figure-functions/">Figure functions</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013-07-09-modifying-data-with-lookup-tables/">Modifying data with lookup tables</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013-05-17-organising-my-project/">Organizing the project directory</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013-05-07-how-long-is-a-function/">How long is a function?</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013-04-30-excel-and-line-endings/">Excel and line endings</a>
      </li>
    
  </ul>
</section>






  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2013 - Rich FitzJohn & Daniel Falster -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'nicercode';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://nicercode.github.com/guides/reports/index.html';
        var disqus_url = 'http://nicercode.github.com/guides/reports/index.html';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
